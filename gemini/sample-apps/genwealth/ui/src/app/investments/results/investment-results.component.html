<div *ngIf="data">
    <app-sql-statement [query]="query">
        @if(data.length == 0) {
            <div class="no-results">No results were found</div>
        } @else {
            See Query
        }
    </app-sql-statement>

    <div *ngIf="generatedQuery">
        <app-sql-statement [query]="generatedQuery">
            See Generated SQL (AlloyDB "Magic")
        </app-sql-statement>
    </div>

    @if(data[0].hasOwnProperty('ticker')) {
    <div class="investment-container">
        <mat-card *ngFor="let investment of data" class="investment-card">
            <mat-card-title>{{investment.ticker}}</mat-card-title>
            <mat-card-subtitle *ngIf="investment.rating">
                <div>
                    Rating: <span class="rating">{{investment.rating}}</span>
                </div>
            </mat-card-subtitle>
            <div innerHtml="{{investment.analysis | textToHtml}}"></div>
        </mat-card>
    </div>
    } @else {
        <table mat-table [dataSource]="data">
            @for (col of getColumns(data[0]); track col; let i = $index) {
            <ng-container matColumnDef="{{ col }}">
                <th mat-header-cell *matHeaderCellDef> {{ col }} </th>
                <td mat-cell *matCellDef="let d"> {{ d[col] }} </td>
              </ng-container>
            }
                <tr mat-header-row *matHeaderRowDef="getColumns(data[0])"></tr>
                <tr mat-row *matRowDef="let myRowData; columns: getColumns(data[0])"></tr>
        </table>
    }
</div>